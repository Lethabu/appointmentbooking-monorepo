# Cloudflare Pages Configuration for AppointmentBooking.co.za
name = "appointmentbooking-coza"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Pages Configuration
[pages]
build_command = "npm run build"
build_output_dir = ".next"
pages_build_output_dir = ".next"
node_compat = true

# Environment Variables - Production
[vars]
NEXT_PUBLIC_APP_URL = "https://appointmentbooking.co.za"
NEXTAUTH_URL = "https://appointmentbooking.co.za"
NODE_ENV = "production"

# Secrets (use wrangler secret put to set these in production)
# These are placeholder references - set via: wrangler secret put NAME

# Build Settings
[env.production]
name = "appointmentbooking-coza-production"

# Functions Configuration
[[env.production.pages.functions]]
directory = "./functions"
binding = "FETCH"

# Build Configuration for Next.js
[env.production.pages.build]
command = "npm run build"
cwd = "./apps/booking"
output_dir = ".next"

# Headers Configuration
[[env.production.pages.headers]]
for = "/*"
[env.production.pages.headers.values]
X-Frame-Options = "DENY"
X-Content-Type-Options = "nosniff"
Referrer-Policy = "strict-origin-when-cross-origin"
X-XSS-Protection = "1; mode=block"
Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"

# Redirects Configuration
[[env.production.pages.redirects]]
from = "/api/*"
to = "/api/:splat"
status = 200

[[env.production.pages.redirects]]
from = "/auth/*"
to = "/api/auth/:splat"
status = 200
