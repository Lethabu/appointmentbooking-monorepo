<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instyle Hair Boutique - Book Your Appointment</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-12 px-4">
        <div class="max-w-2xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-purple-600 mb-2">Instyle Hair Boutique</h1>
                <p class="text-gray-600">Professional Hair Services in Cape Town</p>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-semibold mb-4">Our Services</h2>
                <div id="services-list" class="space-y-4">
                    <div class="text-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"></div>
                        <p class="mt-2 text-gray-500">Loading services...</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">Book Your Appointment</h2>
                <form id="booking-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                        <input type="tel" id="phone" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Service</label>
                        <select id="service" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">Select a service</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Preferred Date</label>
                        <input type="date" id="date" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Preferred Time</label>
                        <select id="time" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">Select time</option>
                            <option value="09:00">09:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="14:00">02:00 PM</option>
                            <option value="15:00">03:00 PM</option>
                            <option value="16:00">04:00 PM</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes (Optional)</label>
                        <textarea id="notes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-purple-600 text-white py-3 px-4 rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 font-semibold">
                        Book Appointment
                    </button>
                </form>
            </div>

            <div class="text-center mt-8 text-gray-500">
                <p>üìû +27 123 456 789 | üìß bookings@instylehairboutique.co.za</p>
                <p class="mt-2">123 Hair Street, Cape Town, South Africa</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://www.instylehairboutique.co.za';
        const TENANT_ID = 'ccb12b4d-ade6-467d-a614-7c9d198ddc70';

        async function loadServices() {
            try {
                const response = await fetch(`${API_BASE}/api/tenant?slug=instylehairboutique`);
                const data = await response.json();
                
                const servicesList = document.getElementById('services-list');
                const serviceSelect = document.getElementById('service');
                
                servicesList.innerHTML = '';
                serviceSelect.innerHTML = '<option value="">Select a service</option>';
                
                data.services.forEach(service => {
                    const serviceDiv = document.createElement('div');
                    serviceDiv.className = 'border rounded-lg p-4 hover:border-purple-300 transition-colors';
                    serviceDiv.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-semibold text-lg">${service.name}</h3>
                                <p class="text-gray-600">${service.description || 'Professional hair service'}</p>
                                <span class="inline-block bg-purple-100 text-purple-800 text-sm px-2 py-1 rounded mt-2">
                                    ${service.duration_minutes} minutes
                                </span>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-bold text-purple-600">R${(service.price / 100).toFixed(0)}</p>
                            </div>
                        </div>
                    `;
                    servicesList.appendChild(serviceDiv);
                    
                    const option = document.createElement('option');
                    option.value = service.id;
                    option.textContent = `${service.name} - R${(service.price / 100).toFixed(0)}`;
                    serviceSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading services:', error);
                document.getElementById('services-list').innerHTML = '<p class="text-red-500">Error loading services. Please refresh the page.</p>';
            }
        }

        document.getElementById('booking-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                tenantId: TENANT_ID,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                serviceId: document.getElementById('service').value,
                scheduledTime: `${document.getElementById('date').value}T${document.getElementById('time').value}:00Z`,
                notes: document.getElementById('notes').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/book`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('üéâ Booking successful! We will contact you to confirm your appointment.');
                    document.getElementById('booking-form').reset();
                } else {
                    alert('‚ùå Booking failed. Please try again or call us directly.');
                }
            } catch (error) {
                console.error('Booking error:', error);
                alert('‚ùå Booking failed. Please try again or call us directly.');
            }
        });

        document.getElementById('date').min = new Date().toISOString().split('T')[0];
        loadServices();
    </script>
</body>
</html>